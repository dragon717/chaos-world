### 命运系统与交互设计

- **命运片段结构**：每个“命运片段”记录为结构体：{事件ID、参与者、行为标签、影响标签、持续时间、影响区域}，储存在角色个人日志中。
- **交互方式**：系统周期性遍历附近NPC的“因果感应树”，匹配片段触发事件响应，如生成新的对话、复仇行动、联盟请求。与角色生命周期整合：在成长阶段积累初始命运片段，在成年阶段通过社会事件扩展因果网。
- **数值表**：
  - `行为标签表`：如行善、盗窃、领导、背叛等，影响NPC好感、道德、命运趋势。
  - `影响值矩阵`：定义不同行为在不同文化/派系下的正负值权重。
  - `区域影响权重表`：计算一个行为在本地、区域、国家层面的扩散程度。
- **行为树设计**：每个NPC绑定行为树模板（如“村民保守型”“士兵忠诚型”“浪人自由型”），通过感知系统输入当前状态和事件，决定执行分支。链接生命周期：行为树在衰老阶段评估长期命运影响。
- **状态机设计**：
  - 状态枚举如：闲置、社交、工作、巡逻、复仇、觉醒。
  - 触发器：时间点（如夜晚）、事件感知（如有人靠近）、情绪阈值（如仇恨>80）。
  - 状态流转：如“复仇中”→“完成”→“反思期”→“社交”。
- **流程概览**：
  1. 玩家行为被记录成命运片段；
  2. 定时/事件触发附近NPC行为树评估；
  3. 若匹配其因果需求，进入状态机下一状态；
  4. 启动事件响应链（对话、任务、战斗等）；
  5. 更新命运网图与后续分支，与传记事件列表同步（参考R-角色生命周期.md）。

#### 与角色生命周期的整合
- **出生与成长阶段**：初始命运由基因和教育事件决定，形成基础因果感应树。基因整合：基因模板影响初始天命标签，天赋ID调整命运趋势概率（e.g. 高天赋增加领导事件概率）。
- **成年与衰老阶段**：社会事件扩展命运片段，影响行为和事件概率，天赋在事件中提供加成。
- **死亡与传承**：命运记录部分传承给后代，影响新角色的初始标签和趋势，包括基因与天赋的权重继承。