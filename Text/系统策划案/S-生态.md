### 生态系统与交互设计

#### 系统概述
生态系统模拟动植物的生长、死亡、演化，与地理、历史、文化、科技深度整合。地理气候影响物种分布与适应；历史事件如瘟疫或战争改变生态平衡；文化习俗（如祭祀）影响资源利用；科技进步（如农业工具）优化产出与消耗。系统强调资源循环：从自然产出，到人类/NPC消耗，再到废物反馈或演化。与角色生命周期整合：在成长阶段通过教育事件学习生态知识，在成年阶段生态事件影响生存和行为。

- **生态结构**：每个“生态实体”记录为结构体：{实体ID、类型（动植物、资源）、位置（地理区域）、状态（生长、成熟、衰亡）、演化因素（气候、事件影响）、产出/消耗值}，储存在生态数据库中。
- **交互方式**：系统周期性模拟生态循环，玩家/NPC行为（如耕作、狩猎）触发响应，如资源产出变化、物种演化或生态事件（洪水、瘟疫）。
- **数值表**：
  - `实体类型表`：如水稻（植物）、野猪（动物）、木材（资源），定义生长周期、死亡条件、演化概率，受地理（e.g. 华夏平原肥沃土壤加速水稻生长）和历史（e.g. 瘟疫增加耐病变异）影响。
  - `资源循环矩阵`：定义产出（e.g. 水稻产粮100单位/季）和消耗（e.g. 人类消耗50单位/人/季），整合文化（e.g. 节日消耗增加20%）和科技（e.g. 工具提升产出15%）。
  - `演化概率表`：计算演化在不同条件下的概率（e.g. 寒冷北境山脉下，牛羊演化耐寒率+30%）。
- **行为树设计**：每个生态实体绑定行为树模板（如“季节生长型”“迁徙型”），通过环境输入（地理气候、历史事件）决定分支，如植物在南部丛林快速生长，动物在西部沙漠迁徙求水。链接生命周期：行为树在衰老阶段考虑资源衰减影响。
- **状态机设计**：
  - 状态枚举如：萌芽/幼生、成熟/繁殖、衰亡/死亡、演化。
  - 触发器：时间周期（e.g. 季节变化）、事件（e.g. 历史战争破坏栖息地）、外部影响（e.g. 文化狩猎过度、科技灌溉）。
  - 状态流转：如“萌芽”→“成熟”（地理适宜）→“繁殖”（资源充足）→“演化”（历史压力下变异）或“衰亡”（消耗过度）。
- **流程概览**：
  1. 系统tick模拟环境（地理+历史）；
  2. 检查实体状态与资源循环；
  3. 若触发条件，进入演化或死亡状态；
  4. 执行响应（产出资源、消耗反馈，如废物肥沃土壤）；
  5. 更新数据库，影响文化（e.g. 丰收节日）和科技（e.g. 新物种解锁研究），与传记事件列表同步（参考R-角色生命周期.md）。

#### 资源循环详解
- **从哪里来**：资源源于地理特定产出（e.g. 华夏平原水稻从河流灌溉土壤中生长，东海群岛鱼类从海洋繁殖），受历史事件加速（e.g. 瘟疫后耐病作物演化），文化保护（e.g. 宗教禁猎区），科技提升（e.g. 冶金炉加工矿石）。
- **到哪里去**：资源被消耗于生存（e.g. 食物喂养人口）、生产（e.g. 木材建屋）、贸易（e.g. 西部沙漠商队交换），废物反馈生态（e.g. 消耗后有机物肥土，促进新生长），或因历史战争销毁、文化节日浪费、科技实验转化。
- **演化机制**：动植物通过“进化阶梯”适应，如北境牛羊死亡后子代演化厚毛；资源循环不平衡触发事件（e.g. 过度消耗导致沙漠化，需文化/科技干预恢复）。

#### 与角色生命周期的整合
- **出生与成长阶段**：生态知识通过教育事件学习，影响初始生存技能。
- **成年与衰老阶段**：生态事件驱动资源利用和演化，衰老阶段增加生态debuff如疾病概率。
- **死亡与传承**：生态经验传承给后代，影响新角色的环境适应性。